<div class="start-page">
    <div class="top-bar">
        <i class="fa fa-arrow-left" (click)="this.closeChat()" style="margin-right: 20px;"></i>
        <div *ngIf="receiverDetails">
                {{receiverDetails.firstName}} {{receiverDetails.lastName}}
        </div>
    </div>
    <div *ngIf="this.listingDetails !== undefined">
        <div *ngIf="this.currentGroupDetails !== undefined">
            <div *ngIf="this.currentUser.uid !== this.listingDetails.donorID">
                <div *ngIf="this.currentGroupDetails.requestStatus === 'none'" 
                    class="mt-2 mb-2 request-button" (click)="handleListingRequest('')">
                        Request for breastmilk
                </div>
                <div *ngIf="this.currentGroupDetails.requestStatus === 'requested'" 
                    class="mt-2 mb-2 request-button" (click)="handleListingRequest('')">
                        Breastmilk donation requested
                </div>
                <div *ngIf="this.currentGroupDetails.requestStatus === 'accepted'" 
                    class="mt-2 mb-2 request-button" (click)="handleListingRequest('')">
                        Breastmilk donation accepted
                </div>
                <div *ngIf="this.currentGroupDetails.requestStatus === 'collacted'" 
                    class="mt-2 mb-2 request-button">
                        Breastmilk donation collacted!
                </div>
            </div>
        </div>
        <div *ngIf="this.currentUser.uid === this.listingDetails.donorID">
            <div *ngIf="this.currentGroupDetails !== undefined">
                <div *ngIf="this.currentGroupDetails.requestStatus === 'requested'">
                    <div class="mt-2 mb-2 request-button" (click)="handleListingRequest('accept')">
                        Accept request
                    </div>
                    <div class="mt-2 mb-2 request-button" (click)="handleListingRequest('reject')">
                        Reject request
                    </div>
                </div>
                <div *ngIf="this.currentGroupDetails.requestStatus === 'accepted'">
                    <div class="mt-2 mb-2 request-button" (click)="handleListingRequest('collacted')">
                        Mark listing as collacted
                    </div>
                    <div class="mt-2 mb-2 request-button" (click)="handleListingRequest('reset')">
                        Reset listing
                    </div>
                </div>
                <div *ngIf="this.currentGroupDetails.requestStatus === 'collacted'">
                    <div class="mt-2 mb-2 request-button" (click)="handleListingRequest('reset')">
                        Reset listing to live
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="!this.currentUserDetails || !this.receiverDetails || !this.listingID" class="loading">
    <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<div *ngIf="this.currentUserDetails">
    <div *ngIf="receiverDetails && listingID" #scrollMe [scrollTop]="scrollMe.scrollHeight" class="messages-area">
        <div *ngIf="messages" class="message-list">
            <div *ngFor="let message of messages">
                <div *ngIf="message.sentBy == this.receiverDetails.userID">
                    <div class="message-area-receiver">
                        <div class="message-receiver"> {{message.message}}</div>
                    </div> 
                </div>
                <div *ngIf="message.sentBy == this.currentUserDetails.userID">
                    <div class="message-area-sender">
                        <div class="message-sender"> {{message.message}}</div>
                    </div> 
                </div>
            </div>
        </div>
    </div>
    
    <div class="new-message">
        <div class="new-message-area">
            <textarea class="new-message-box" role="textbox" maxlines="5"  [(ngModel)]="newMessage" contenteditable></textarea>
            <div class="send-btn"  (click)="send(newMessage)">
                <i class="fa fa-paper-plane" aria-hidden="true"></i>
            </div>
        </div>
    </div>
</div>
